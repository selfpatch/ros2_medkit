# ROS 2 Medkit Gateway Configuration Parameters
#
# This file contains default configuration for the ROS 2 Medkit Gateway.
# You can override these values via:
#   - Command line: --ros-args -p server.port:=9000
#   - Launch files: parameters=[...]
#   - This YAML file

ros2_medkit_gateway:
  ros__parameters:
    # Server Configuration
    server:
      # Host to bind the REST server to
      # Options:
      #   - "127.0.0.1" (localhost only - SECURE, default)
      #   - "0.0.0.0" (all interfaces - use for Docker/networking)
      host: "127.0.0.1"

      # Port for REST API
      # Valid range: 1024-65535
      port: 8080

      # TLS/HTTPS Configuration
      # Enables encrypted communication using OpenSSL
      tls:
        # Enable/disable TLS (default: false for backward compatibility)
        enabled: false

        # Path to PEM-encoded certificate file (required when TLS enabled)
        # Example: "/etc/ros2_medkit/certs/cert.pem"
        cert_file: ""

        # Path to PEM-encoded private key file (required when TLS enabled)
        # SECURITY: Private key should have restricted permissions (chmod 600)
        # Example: "/etc/ros2_medkit/certs/key.pem"
        key_file: ""

        # Optional: Path to CA certificate file for client verification
        # TODO: Used for mutual TLS when implemented
        # Example: "/etc/ros2_medkit/certs/ca.pem"
        ca_file: ""

        # Minimum TLS version
        # Options: "1.2" (default, widely compatible), "1.3" (more secure)
        min_version: "1.2"

        # TODO: Mutual TLS (client certificate verification) is not yet implemented
        # See: https://github.com/selfpatch/ros2_medkit/issues/XXX

    # Cache refresh interval in milliseconds
    # How often to discover ROS 2 nodes and update the cache
    # Valid range: 100-60000 (0.1s to 60s)
    # Default: 10000 (10 seconds) - optimized for developer experience
    refresh_interval_ms: 10000

    # CORS Configuration
    # Cross-Origin Resource Sharing settings for browser-based clients
    # If cors section is missing or empty, CORS handling is disabled
    cors:
      # List of allowed origins
      # Examples: ["http://localhost:5173", "https://example.com"]
      # Use ["*"] to allow all origins (not recommended for production)
      # Empty list = CORS disabled (use [""] for ROS 2 YAML compatibility)
      allowed_origins: [""]

      # Allowed HTTP methods for CORS requests
      # Default: ["GET", "PUT", "OPTIONS"]
      allowed_methods: ["GET", "PUT", "OPTIONS"]

      # Allowed headers in CORS requests
      # List the allowed headers explicitly (wildcard "*" is not supported)
      allowed_headers: ["Content-Type", "Accept"]

      # Whether to allow credentials (cookies, authorization headers)
      # When true, allowed_origins cannot be ["*"]
      allow_credentials: false

      # How long (in seconds) browsers should cache preflight response
      # Default: 86400 (24 hours)
      max_age_seconds: 86400

    # Data Access Configuration
    # Maximum number of concurrent topic samples when fetching component data
    # Higher values improve response time but use more system resources
    # Valid range: 1-50
    max_parallel_topic_samples: 20

    # Timeout (in seconds) for sampling topic data via native GenericSubscription
    # Topics without publishers return immediately with metadata (no timeout wait)
    # This timeout only applies when topics have active publishers
    # Valid range: 0.1-30.0
    topic_sample_timeout_sec: 2.0

    # NOTE: Native-only implementation
    # The gateway uses native rclcpp APIs for all ROS 2 interactions:
    # - Topic discovery: node->get_topic_names_and_types()
    # - Topic sampling: rclcpp::GenericSubscription + JsonSerializer
    # - Topic publishing: rclcpp::GenericPublisher + JsonSerializer
    # - Service calls: rclcpp::GenericClient + JsonSerializer
    # - Action operations: Internal action services via GenericClient
    # No ROS 2 CLI dependencies - pure C++ implementation using ros2_medkit_serialization.

    # Authentication Configuration (REQ_INTEROP_086, REQ_INTEROP_087)
    # JWT-based authentication with Role-Based Access Control (RBAC)
    auth:
      # Enable/disable authentication
      # Default: false (disabled for local development)
      enabled: false

      # JWT signing secret (required when enabled)
      # For HS256: The shared secret string
      # For RS256: Path to the private key file (PEM format)
      jwt_secret: ""

      # Path to public key file for RS256 (required for RS256, optional for HS256)
      jwt_public_key: ""

      # JWT signing algorithm
      # Options: "HS256" (symmetric, default), "RS256" (asymmetric)
      jwt_algorithm: "HS256"

      # Access token validity period in seconds
      # Default: 3600 (1 hour)
      token_expiry_seconds: 3600

      # Refresh token validity period in seconds
      # Default: 86400 (24 hours)
      # Must be >= token_expiry_seconds
      refresh_token_expiry_seconds: 86400

      # When to require authentication
      # Options:
      #   - "none": No authentication required (auth endpoints still available)
      #   - "write": Auth required for write operations (POST, PUT, DELETE)
      #   - "all": Auth required for all operations
      # Default: "write"
      require_auth_for: "write"

      # JWT issuer claim
      # Default: "ros2_medkit_gateway"
      issuer: "ros2_medkit_gateway"

      # Pre-configured clients for authentication
      # Format: "client_id:client_secret:role"
      # Roles: viewer, operator, configurator, admin
      #
      # Role permissions:
      #   - viewer: Read-only access (GET on areas, components, data, faults)
      #   - operator: Viewer + trigger operations, acknowledge faults, publish data
      #   - configurator: Operator + modify/reset configurations
      #   - admin: Full access including auth management
      #
      # Example:
      #   clients: ["admin:admin_secret_123:admin", "viewer:viewer_pass:viewer"]
      clients: [""]
